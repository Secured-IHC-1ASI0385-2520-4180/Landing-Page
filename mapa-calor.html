<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Mapa de calor - Landing</title>
    <link rel="stylesheet" href="Secured-Landing-Page/public/assets/styles/mapa-calor.css" />
</head>
<body>
<main class="page">
    <header class="topbar">
        <a href="variaciones-varias.html" class="back" aria-label="volver">←</a>
        <div class="title">
            Mapa de calor <span class="subtitle">Análisis de concentración</span>
        </div>
    </header>

    <section class="controls">
        <div class="search">
            <svg class="icon" viewBox="0 0 24 24" width="18" height="18">
                <circle
                        cx="11"
                        cy="11"
                        r="6"
                        stroke-width="2"
                        stroke="#6b7280"
                        fill="none"
                />
                <path
                        d="M21 21l-4.35-4.35"
                        stroke="#6b7280"
                        stroke-width="2"
                        fill="none"
                        stroke-linecap="round"
                />
            </svg>
            <input placeholder="Buscar por código o ubicación..." />
        </div>

        <div class="time-tabs">
            <button class="tab">1h</button>
            <button class="tab active">24h</button>
            <button class="tab">7d</button>
        </div>

        <div class="actions">
            <button id="btn-filters" class="action">🔍 Filtros</button>
            <button id="btn-export" class="action export">
                ⬇️ Exportar vista
            </button>
        </div>
    </section>

    <section class="map-area">
        <div class="map-container" role="img" aria-label="Mapa de calor">
            <img
                    src="Secured-Landing-Page/public/assets/images/capa.png"
                    alt="Mapa de calor de ejemplo"
                    class="map-image"
            />

            <div class="overlay top-right">
                <div class="incidents">47 incidentes</div>
                <button class="loc">📍</button>
            </div>

            <div class="zoom-controls">
                <button>＋</button>
                <button>－</button>
            </div>

            <div class="legend">
                <div class="legend-title">Intensidad de incidentes</div>
                <div class="legend-bar">
                    <div class="low">Baja</div>
                    <div class="mid">Media</div>
                    <div class="high">Alta</div>
                </div>
            </div>
        </div>
    </section>

    <footer class="bottom-action">
        <button id="btn-export-floating" class="export-floating">
            ⬇️ Exportar vista
        </button>
    </footer>

    <!-- Filters Modal -->
    <div id="modal-filters" class="modal" aria-hidden="true">
        <div class="modal-sheet">
            <div class="modal-header">
                <h3>Filtros</h3>
                <button class="close" data-close>✕</button>
            </div>

            <div class="modal-content">
                <div class="section">
                    <div class="label">Tipo de incidente</div>
                    <div class="button-grid" id="types">
                        <button class="pill">Robo</button>
                        <button class="pill">Vandalismo</button>
                    </div>
                </div>

                <div class="section">
                    <div class="label">Jurisdicción / Zona</div>
                    <div class="button-grid" id="zones">
                        <button class="pill">Miraflores</button>
                        <button class="pill">Barranco</button>
                        <button class="pill">San Isidro</button>
                        <button class="pill">Surco</button>
                        <button class="pill">San Borja</button>
                        <button class="pill">La Molina</button>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-primary" id="apply-filters">
                    Aplicar filtros
                </button>
                <button class="btn" data-close>Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="modal-export" class="modal" aria-hidden="true">
        <div class="modal-sheet">
            <div class="modal-header">
                <h3>Exportar vista</h3>
                <button class="close" data-close>✕</button>
            </div>

            <div class="modal-content">
                <div class="export-summary">
                    <p>La imagen incluirá:</p>
                    <ul>
                        <li>Vista actual del mapa de calor</li>
                        <li>Ventana: última hora</li>
                        <li>Total: 12 incidentes</li>
                        <li>Fecha y hora: 24 de octubre de 2025, 03:16 a. m.</li>
                    </ul>
                    <p class="muted">
                        La imagen se guardará en tu dispositivo con un sello de fecha y
                        ventana temporal para referencia.
                    </p>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-primary" id="export-now">
                    Exportar imagen
                </button>
                <button class="btn" data-close>Cancelar</button>
            </div>
        </div>
    </div>
</main>

<script>
    const modalFilters = document.getElementById("modal-filters");
    const modalExport = document.getElementById("modal-export");
    const btnFilters = document.getElementById("btn-filters");
    const btnExport = document.getElementById("btn-export");
    const btnExportFloat = document.getElementById("btn-export-floating");
    const applyFilters = document.getElementById("apply-filters");

    function openModal(m) {
        m.setAttribute("aria-hidden", "false");
        document.body.classList.add("blurred");
    }
    function closeModal(m) {
        m.setAttribute("aria-hidden", "true");
        document.body.classList.remove("blurred");
    }

    btnFilters.addEventListener("click", () => openModal(modalFilters));
    btnExport.addEventListener("click", () => openModal(modalExport));
    btnExportFloat.addEventListener("click", () => openModal(modalExport));

    document
        .querySelectorAll("[data-close]")
        .forEach((btn) =>
            btn.addEventListener("click", (e) =>
                closeModal(e.target.closest(".modal"))
            )
        );

    document
        .querySelectorAll(".modal .close")
        .forEach((btn) =>
            btn.addEventListener("click", (e) =>
                closeModal(e.target.closest(".modal"))
            )
        );

    document.querySelectorAll(".modal").forEach((mod) => {
        mod.addEventListener("click", (e) => {
            if (e.target === mod) closeModal(mod);
        });
    });

    applyFilters.addEventListener("click", () => closeModal(modalFilters));

    document
        .querySelectorAll(".pill")
        .forEach((btn) =>
            btn.addEventListener("click", () => btn.classList.toggle("selected"))
        );

    document.getElementById("export-now").addEventListener("click", () => {
        const btn = document.getElementById("export-now");
        btn.textContent = "Exportando...";
        btn.disabled = true;

        setTimeout(() => {
            btn.textContent = "Exportar imagen";
            btn.disabled = false;
            closeModal(modalExport);

            const toast = document.createElement("div");
            toast.className = "toast";
            toast.textContent = "Imagen exportada en tu dispositivo (simulado)";
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }, 1200);
    });
</script>
</body>
</html>
